{"ast":null,"code":"\"use strict\";\n\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nvar __createBinding = this && this.__createBinding || (Object.create ? function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  Object.defineProperty(o, k2, {\n    enumerable: true,\n    get: function () {\n      return m[k];\n    }\n  });\n} : function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\n\nvar __setModuleDefault = this && this.__setModuleDefault || (Object.create ? function (o, v) {\n  Object.defineProperty(o, \"default\", {\n    enumerable: true,\n    value: v\n  });\n} : function (o, v) {\n  o[\"default\"] = v;\n});\n\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n\n  __setModuleDefault(result, mod);\n\n  return result;\n};\n\nvar __rest = this && this.__rest || function (s, e) {\n  var t = {};\n\n  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];\n\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n    if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i])) t[p[i]] = s[p[i]];\n  }\n  return t;\n};\n\nvar __read = this && this.__read || function (o, n) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o),\n      r,\n      ar = [],\n      e;\n\n  try {\n    while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n  } catch (error) {\n    e = {\n      error: error\n    };\n  } finally {\n    try {\n      if (r && !r.done && (m = i[\"return\"])) m.call(i);\n    } finally {\n      if (e) throw e.error;\n    }\n  }\n\n  return ar;\n};\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.CustomGallery = void 0;\n\nvar photoswipe_1 = __importDefault(require(\"photoswipe\"));\n\nvar react_1 = __importStar(require(\"react\"));\n\nvar prop_types_1 = __importDefault(require(\"prop-types\"));\n\nvar helpers_1 = require(\"./helpers\");\n\nvar context_1 = require(\"./context\");\n\nvar gallery_base_1 = require(\"./gallery-base\");\n/**\n * Gallery component with ability to use specific UI and Layout\n */\n\n\nvar CustomGallery = function (_a) {\n  var children = _a.children,\n      layoutRef = _a.layoutRef,\n      ui = _a.ui,\n      options = _a.options,\n      galleryUID = _a.id,\n      onOpen = _a.onOpen;\n  var items = react_1.useRef(new Map());\n  var openWhenReadyPid = react_1.useRef(null);\n  var open = react_1.useCallback(function (targetRef, targetId, itemIndex) {\n    var index = itemIndex || null;\n    var normalized = [];\n    var entries = Array.from(items.current);\n\n    var prepare = function (entry, i) {\n      var _a = __read(entry, 2),\n          ref = _a[0],\n          _b = _a[1],\n          width = _b.width,\n          height = _b.height,\n          title = _b.title,\n          original = _b.original,\n          thumbnail = _b.thumbnail,\n          pid = _b.id,\n          rest = __rest(_b, [\"width\", \"height\", \"title\", \"original\", \"thumbnail\", \"id\"]);\n\n      if (targetRef === ref || pid !== undefined && String(pid) === targetId) {\n        index = i;\n      }\n\n      normalized.push(__assign(__assign(__assign(__assign({}, title ? {\n        title: title\n      } : {}), {\n        w: Number(width),\n        h: Number(height),\n        src: original,\n        msrc: thumbnail,\n        el: ref.current\n      }), pid !== undefined ? {\n        pid: pid\n      } : {}), rest));\n    };\n\n    if (items.current.size > 1) {\n      entries.sort(function (_a, _b) {\n        var _c = __read(_a, 1),\n            a = _c[0].current;\n\n        var _d = __read(_b, 1),\n            b = _d[0].current;\n\n        return helpers_1.sortNodes(a, b);\n      }).forEach(prepare);\n    } else {\n      entries.forEach(prepare);\n    }\n\n    var layoutEl = layoutRef.current;\n\n    if (layoutEl) {\n      var instance = new photoswipe_1.default(layoutEl, ui, normalized, __assign(__assign({\n        index: index === null ? parseInt(targetId, 10) - 1 : index,\n        getThumbBoundsFn: function (thumbIndex) {\n          var el = normalized[thumbIndex].el;\n          return el ? helpers_1.getElBounds(el) : {\n            x: 0,\n            y: 0,\n            w: 0\n          };\n        },\n        history: false\n      }, galleryUID !== undefined ? {\n        galleryUID: galleryUID,\n        history: true\n      } : {}), options || {}));\n      instance.init();\n\n      if (onOpen !== undefined && typeof onOpen === 'function') {\n        onOpen(instance);\n      }\n    }\n  }, [options, galleryUID, onOpen]);\n  react_1.useEffect(function () {\n    if (galleryUID === undefined) {\n      return;\n    }\n\n    var hash = window.location.hash.substring(1);\n    var params = {};\n\n    if (hash.length < 5) {\n      return;\n    }\n\n    var vars = hash.split('&');\n\n    for (var i = 0; i < vars.length; i++) {\n      if (vars[i]) {\n        var _a = __read(vars[i].split('='), 2),\n            key = _a[0],\n            value = _a[1];\n\n        if (key && value) {\n          params[key] = value;\n        }\n      }\n    }\n\n    var pid = params.pid,\n        gid = params.gid;\n\n    if (items.current.size === 0) {\n      openWhenReadyPid.current = pid;\n      return;\n    }\n\n    if (pid && gid === String(galleryUID)) {\n      open(null, pid);\n    }\n  }, [open, galleryUID]);\n  var remove = react_1.useCallback(function (ref) {\n    items.current.delete(ref);\n  }, []);\n  var set = react_1.useCallback(function (ref, data) {\n    var id = data.id;\n    items.current.set(ref, data);\n    if (!openWhenReadyPid.current) return;\n\n    if (id === openWhenReadyPid.current) {\n      open(ref);\n      openWhenReadyPid.current = null;\n    } else if (!id) {\n      var index = parseInt(openWhenReadyPid.current, 10) - 1;\n      var refToOpen = Array.from(items.current.keys())[index];\n\n      if (refToOpen) {\n        open(refToOpen);\n        openWhenReadyPid.current = null;\n      }\n    }\n  }, [open]);\n  var openAt = react_1.useCallback(function (index) {\n    open(null, null, index);\n  }, [open]);\n  return react_1.default.createElement(context_1.Context.Provider, {\n    value: {\n      remove: remove,\n      set: set,\n      handleClick: open,\n      open: openAt\n    }\n  }, children);\n};\n\nexports.CustomGallery = CustomGallery;\nexports.CustomGallery.propTypes = __assign(__assign({}, gallery_base_1.baseGalleryPropTypes), {\n  // @ts-ignore\n  layoutRef: prop_types_1.default.shape({\n    current: prop_types_1.default.instanceOf(typeof Element === 'undefined' ?\n    /** @class */\n    function () {\n      function Element() {}\n\n      return Element;\n    }() : Element)\n  }).isRequired,\n  ui: prop_types_1.default.any.isRequired\n});","map":null,"metadata":{},"sourceType":"script"}